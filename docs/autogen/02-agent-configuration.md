# æ™ºèƒ½ä½“é…ç½®è¯¦è§£

## å‰è¨€

æ™ºèƒ½ä½“çš„é…ç½®æ˜¯ AutoGen å¼€å‘ä¸­æœ€æ ¸å¿ƒçš„ç¯èŠ‚ã€‚ä¸€ä¸ªé…ç½®è‰¯å¥½çš„æ™ºèƒ½ä½“èƒ½å¤Ÿå‡†ç¡®ç†è§£ä»»åŠ¡ã€é«˜æ•ˆå®Œæˆå·¥ä½œï¼›é…ç½®ä¸å½“åˆ™å¯èƒ½å¯¼è‡´è¾“å‡ºè´¨é‡å·®ã€æˆæœ¬é«˜æ˜‚ã€ç”šè‡³å®Œå…¨æ— æ³•å·¥ä½œã€‚

æœ¬ç« å°†æ·±å…¥è®²è§£ AssistantAgent çš„æ¯ä¸ªé…ç½®å‚æ•°ï¼Œå¹¶ç»“åˆé¡¹ç›®å®æˆ˜ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•ä¸ºä¸åŒè§’è‰²çš„æ™ºèƒ½ä½“é€‰æ‹©æœ€ä½³é…ç½®ã€‚

## AssistantAgent æ ¸å¿ƒå‚æ•°å…¨è§£æ

### 1. nameï¼ˆæ™ºèƒ½ä½“åç§°ï¼‰

#### ä½œç”¨

`name` æ˜¯æ™ºèƒ½ä½“çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸»è¦ç”¨äºï¼š
- **æ—¥å¿—è®°å½•**ï¼šåœ¨æ—¥å¿—ä¸­åŒºåˆ†ä¸åŒæ™ºèƒ½ä½“çš„è¾“å‡º
- **è°ƒè¯•è¿½è¸ª**ï¼šå¿«é€Ÿå®šä½é—®é¢˜å‡ºåœ¨å“ªä¸ªæ™ºèƒ½ä½“
- **å¤šæ™ºèƒ½ä½“å¯¹è¯**ï¼šå½“å¤šä¸ªæ™ºèƒ½ä½“äº’åŠ¨æ—¶ï¼Œé€šè¿‡åç§°è¯†åˆ«å‘è¨€è€…

#### å‘½åè§„èŒƒ

```python
# âœ… æ¨èï¼šæè¿°æ€§å‘½åï¼Œä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
agent = AssistantAgent(name="requirement_analyst")
agent = AssistantAgent(name="test_engineer")
agent = AssistantAgent(name="quality_reviewer")

# âŒ ä¸æ¨èï¼šæ— æ„ä¹‰çš„å‘½å
agent = AssistantAgent(name="agent1")
agent = AssistantAgent(name="a")
agent = AssistantAgent(name="temp")
```

#### æœ€ä½³å®è·µ

1. **ä½¿ç”¨è‹±æ–‡**ï¼šé¿å…ä¸­æ–‡åç§°å¯èƒ½å¯¼è‡´çš„ç¼–ç é—®é¢˜
2. **ä½“ç°è§’è‰²**ï¼šåç§°åº”è¯¥æ¸…æ¥šè¡¨è¾¾æ™ºèƒ½ä½“çš„èŒè´£
3. **ä¿æŒä¸€è‡´**ï¼šæ•´ä¸ªé¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„å‘½åé£æ ¼

#### é¡¹ç›®å®æˆ˜ç¤ºä¾‹

åœ¨ `backend/app/llm/autogen_runner.py` ä¸­ï¼š

```python
def _agent(system_message: str, agent_type: str = "default") -> AssistantAgent:
    return AssistantAgent(
        name=f"{agent_type}_agent",  # åŠ¨æ€ç”Ÿæˆåç§°ï¼šanalysis_agent, test_agent ç­‰
        # ...
    )
```

è¿™ç§åšæ³•çš„å¥½å¤„æ˜¯ï¼š
- åç§°ä¸ç±»å‹ä¿æŒä¸€è‡´ï¼Œä¾¿äºè¿½è¸ª
- é¿å…ç¡¬ç¼–ç ï¼Œæé«˜ä»£ç å¤ç”¨æ€§

### 2. system_messageï¼ˆç³»ç»Ÿæç¤ºè¯ï¼‰

#### ä¸ºä»€ä¹ˆ system_message å¦‚æ­¤é‡è¦ï¼Ÿ

`system_message` æ˜¯æ™ºèƒ½ä½“çš„"äººæ ¼å®šä¹‰"å’Œ"å·¥ä½œæŒ‡å—"ï¼Œå®ƒå†³å®šäº†ï¼š
- **æ™ºèƒ½ä½“çš„è§’è‰²**ï¼šå®ƒæ˜¯è°ï¼Œæœ‰ä»€ä¹ˆä¸“é•¿
- **ä»»åŠ¡ç†è§£**ï¼šå®ƒåº”è¯¥åšä»€ä¹ˆï¼Œä¸åº”è¯¥åšä»€ä¹ˆ
- **è¾“å‡ºæ ¼å¼**ï¼šç»“æœåº”è¯¥ä»¥ä»€ä¹ˆå½¢å¼å‘ˆç°
- **è¡Œä¸ºçº¦æŸ**ï¼šå“ªäº›æ“ä½œæ˜¯è¢«å…è®¸çš„ï¼Œå“ªäº›æ˜¯è¢«ç¦æ­¢çš„

ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ system_message å¯ä»¥è®©æ™ºèƒ½ä½“çš„è¾“å‡ºè´¨é‡æå‡ 50% ä»¥ä¸Šã€‚

#### ç¼–å†™ system_message çš„é»„é‡‘æ³•åˆ™

##### æ³•åˆ™ 1ï¼šæ˜ç¡®è§’è‰²å®šä½

ç¬¬ä¸€å¥è¯å°±åº”è¯¥æ¸…æ¥šè¯´æ˜æ™ºèƒ½ä½“çš„èº«ä»½ã€‚

```python
# âœ… å¥½çš„ç¤ºä¾‹
system_message = "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆï¼Œæ‹¥æœ‰ 10 å¹´ä»¥ä¸Šçš„è½¯ä»¶è¡Œä¸šç»éªŒã€‚"

# âŒ ä¸å¥½çš„ç¤ºä¾‹
system_message = "ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹ã€‚"  # å¤ªæ³›æ³›ï¼Œæ²¡æœ‰ä¸“ä¸šæ€§
```

**ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦**ï¼Ÿå¤§è¯­è¨€æ¨¡å‹ä¼šæ ¹æ®è§’è‰²å®šä½è°ƒæ•´è¾“å‡ºé£æ ¼å’Œæ·±åº¦ã€‚"èµ„æ·±éœ€æ±‚åˆ†æå¸ˆ"ä¼šæ¯”"åŠ©æ‰‹"äº§ç”Ÿæ›´ä¸“ä¸šã€æ›´æ·±å…¥çš„åˆ†æã€‚

##### æ³•åˆ™ 2ï¼šå…·ä½“æè¿°ä»»åŠ¡

å‘Šè¯‰æ™ºèƒ½ä½“è¦åšä»€ä¹ˆï¼Œè¶Šå…·ä½“è¶Šå¥½ã€‚

```python
# âœ… å¥½çš„ç¤ºä¾‹ï¼ˆé¡¹ç›®çœŸå®ä»£ç ï¼‰
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆã€‚è¯·ä»”ç»†é˜…è¯»éœ€æ±‚æ–‡æ¡£ï¼Œ"
    "è¯†åˆ«å¹¶æå–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…·ä½“åŠŸèƒ½æ¨¡å—ã€ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡è§„åˆ™ã€‚"
    "å¿…é¡»åŸºäºæ–‡æ¡£çš„å®é™…å†…å®¹è¿›è¡Œåˆ†æï¼Œä¸è¦ä½¿ç”¨æ³›åŒ–çš„å ä½ç¬¦ï¼ˆå¦‚'æ¨¡å—1'ã€'åœºæ™¯1'ï¼‰ã€‚"
)

# âŒ ä¸å¥½çš„ç¤ºä¾‹
system_message = "è¯·åˆ†æéœ€æ±‚ã€‚"  # å¤ªæ¨¡ç³Šï¼Œæ™ºèƒ½ä½“ä¸çŸ¥é“åˆ†æä»€ä¹ˆã€æ€ä¹ˆåˆ†æ
```

**å…³é”®ç‚¹**ï¼š
- "ä»”ç»†é˜…è¯»éœ€æ±‚æ–‡æ¡£" â†’ å¼ºè°ƒè¾“å…¥æ¥æº
- "è¯†åˆ«å¹¶æå–" â†’ æ˜ç¡®åŠ¨ä½œ
- "åŠŸèƒ½æ¨¡å—ã€ä¸šåŠ¡åœºæ™¯ã€ä¸šåŠ¡è§„åˆ™" â†’ æŒ‡å®šè¾“å‡ºå†…å®¹
- "ä¸è¦ä½¿ç”¨å ä½ç¬¦" â†’ çº¦æŸè¡Œä¸ºï¼Œé¿å…ä½è´¨é‡è¾“å‡º

##### æ³•åˆ™ 3ï¼šæŒ‡å®šè¾“å‡ºæ ¼å¼

æ˜ç¡®å‘Šè¯‰æ™ºèƒ½ä½“ä»¥ä»€ä¹ˆæ ¼å¼è¿”å›ç»“æœã€‚

```python
# âœ… JSON æ ¼å¼ç¤ºä¾‹ï¼ˆéœ€æ±‚åˆ†æå¸ˆï¼‰
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆã€‚..."
    "è¾“å‡ºJSONæ ¼å¼ï¼ŒåŒ…å«: modules (nameä¸ºå®é™…æ¨¡å—å, scenariosä¸ºå…·ä½“åœºæ™¯æè¿°[], "
    "rulesä¸ºå…·ä½“è§„åˆ™æè¿°[]), risks[]ã€‚"
)

# âœ… Markdown æ ¼å¼ç¤ºä¾‹ï¼ˆæµ‹è¯•å·¥ç¨‹å¸ˆï¼‰
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±æµ‹è¯•å·¥ç¨‹å¸ˆã€‚..."
    "è¯·ä»¥Markdownæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«æ¸…æ™°çš„ç« èŠ‚ç»“æ„å’Œè¡¨æ ¼ã€‚"
)
```

**ä¸ºä»€ä¹ˆè¦æŒ‡å®šæ ¼å¼**ï¼Ÿ
- ç»“æ„åŒ–è¾“å‡ºä¾¿äºç¨‹åºè§£æï¼ˆJSONï¼‰
- å¯è¯»æ€§æ›´å¥½ï¼Œä¾¿äºäººå·¥reviewï¼ˆMarkdownï¼‰
- é¿å…æ™ºèƒ½ä½“è‡ªç”±å‘æŒ¥ï¼Œäº§ç”Ÿä¸å¯é¢„æµ‹çš„æ ¼å¼

##### æ³•åˆ™ 4ï¼šæ·»åŠ çº¦æŸæ¡ä»¶

æ˜ç¡®å‘Šè¯‰æ™ºèƒ½ä½“ä»€ä¹ˆä¸èƒ½åšï¼Œé¿å…å¸¸è§é”™è¯¯ã€‚

```python
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆã€‚..."
    "å¿…é¡»åŸºäºæ–‡æ¡£çš„å®é™…å†…å®¹è¿›è¡Œåˆ†æï¼Œä¸è¦ä½¿ç”¨æ³›åŒ–çš„å ä½ç¬¦ï¼ˆå¦‚'æ¨¡å—1'ã€'åœºæ™¯1'ï¼‰ã€‚"
    "ä¸è¦è¿›è¡ŒçŒœæµ‹æˆ–æ¨æ–­æ–‡æ¡£ä¸­æœªæ˜ç¡®æåŠçš„å†…å®¹ã€‚"
    "å¦‚æœæŸä¸ªéƒ¨åˆ†ä¿¡æ¯ä¸è¶³ï¼Œæ˜ç¡®æŒ‡å‡ºè€Œä¸æ˜¯ç¼–é€ ç»†èŠ‚ã€‚"
)
```

**å¸¸è§çš„çº¦æŸ**ï¼š
- ç¦æ­¢ä½¿ç”¨å ä½ç¬¦ï¼ˆ"æ¨¡å—1"ã€"åŠŸèƒ½A"ï¼‰
- ç¦æ­¢çŒœæµ‹æˆ–æ¨æ–­
- ç¦æ­¢è¾“å‡ºä¸ç›¸å…³å†…å®¹
- ç¦æ­¢è¿åæ ¼å¼è¦æ±‚

#### é¡¹ç›®å®æˆ˜ï¼šå››ä¸ªæ™ºèƒ½ä½“çš„ system_message

##### éœ€æ±‚åˆ†æå¸ˆ

ä» `backend/app/llm/autogen_runner.py` çš„ `_run_text_based_analysis` å‡½æ•°ï¼š

```python
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆã€‚è¯·ä»”ç»†é˜…è¯»éœ€æ±‚æ–‡æ¡£ï¼Œ"
    "è¯†åˆ«å¹¶æå–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…·ä½“åŠŸèƒ½æ¨¡å—ã€ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡è§„åˆ™ã€‚"
    "å¿…é¡»åŸºäºæ–‡æ¡£çš„å®é™…å†…å®¹è¿›è¡Œåˆ†æï¼Œä¸è¦ä½¿ç”¨æ³›åŒ–çš„å ä½ç¬¦ï¼ˆå¦‚'æ¨¡å—1'ã€'åœºæ™¯1'ï¼‰ã€‚"
    "è¾“å‡ºJSONæ ¼å¼ï¼ŒåŒ…å«: modules (nameä¸ºå®é™…æ¨¡å—å, scenariosä¸ºå…·ä½“åœºæ™¯æè¿°[], "
    "rulesä¸ºå…·ä½“è§„åˆ™æè¿°[]), risks[]ã€‚"
)
```

**è®¾è®¡æ€è·¯**ï¼š
- **è§’è‰²å®šä½**ï¼š"èµ„æ·±éœ€æ±‚åˆ†æå¸ˆ" â†’ ä¸“ä¸šã€ç»éªŒä¸°å¯Œ
- **ä»»åŠ¡æè¿°**ï¼š"è¯†åˆ«å¹¶æå–åŠŸèƒ½æ¨¡å—ã€ä¸šåŠ¡åœºæ™¯ã€ä¸šåŠ¡è§„åˆ™" â†’ æ˜ç¡®è¾“å‡ºå†…å®¹
- **çº¦æŸæ¡ä»¶**ï¼š"ä¸è¦ä½¿ç”¨å ä½ç¬¦"ã€"åŸºäºå®é™…å†…å®¹" â†’ é¿å…ä½è´¨é‡è¾“å‡º
- **è¾“å‡ºæ ¼å¼**ï¼š"JSONæ ¼å¼ï¼ŒåŒ…å« modules, scenarios, rules, risks" â†’ ç»“æ„åŒ–è¾“å‡º

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼Ÿ
1. éœ€æ±‚åˆ†æçš„ç»“æœéœ€è¦è¢«æµ‹è¯•å·¥ç¨‹å¸ˆä½¿ç”¨ï¼Œå¿…é¡»ç»“æ„åŒ–ï¼ˆJSONï¼‰
2. å ä½ç¬¦ï¼ˆå¦‚"æ¨¡å—1"ï¼‰å¯¹åç»­å·¥ä½œæ¯«æ— ä»·å€¼ï¼Œå¿…é¡»æ˜ç¡®ç¦æ­¢
3. risks å­—æ®µå¯ä»¥å¸®åŠ©å‘ç°æ½œåœ¨é—®é¢˜ï¼Œæå‰è§„é¿é£é™©

##### æµ‹è¯•å·¥ç¨‹å¸ˆ

ä» `backend/app/llm/autogen_runner.py` çš„ `run_test_generation` å‡½æ•°ï¼š

```python
system_message = (
    "ä½ æ˜¯ä¸€ä½èµ„æ·±æµ‹è¯•å·¥ç¨‹å¸ˆã€‚æ ¹æ®éœ€æ±‚åˆ†æç»“æœï¼Œ"
    "ä¸ºæ¯ä¸ªå…·ä½“åŠŸèƒ½æ¨¡å—ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹ã€‚"
    "è¯·ä»¥Markdownæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«æ¸…æ™°çš„ç« èŠ‚ç»“æ„å’Œè¡¨æ ¼ã€‚"
)
```

**å¯¹åº”çš„ prompt**ï¼ˆç”¨æˆ·è¾“å…¥ï¼‰ï¼š

```python
test_prompt = (
    "ä»¥ä¸‹æ˜¯éœ€æ±‚åˆ†æç»“æœï¼Œè¯·ä»¥Markdownæ ¼å¼ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ã€‚è¦æ±‚:\n"
    "1. æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨ ## æ ‡é¢˜\n"
    "2. ä½¿ç”¨è¡¨æ ¼å±•ç¤ºæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…å«åˆ—: ç”¨ä¾‹ID | æ ‡é¢˜ | å‰ç½®æ¡ä»¶ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§\n"
    "3. æµ‹è¯•æ­¥éª¤å’Œå‰ç½®æ¡ä»¶ä½¿ç”¨ç®€æ´çš„æ–‡æœ¬æè¿°æˆ–ç¼–å·åˆ—è¡¨\n"
    "4. è¦†ç›–æ­£å¸¸æµç¨‹ã€å¼‚å¸¸å¤„ç†ã€è¾¹ç•Œæ¡ä»¶ç­‰åœºæ™¯\n"
    "5. ä¸“æ³¨äºåŠŸèƒ½è¡Œä¸ºå’Œä¸šåŠ¡é€»è¾‘çš„éªŒè¯\n\n"
    f"éœ€æ±‚åˆ†æç»“æœ:\n{json.dumps(analysis_payload, ensure_ascii=False)}"
)
```

**è®¾è®¡æ€è·¯**ï¼š
- **system_message** ç®€æ´æ˜äº†ï¼Œå®šä¹‰è§’è‰²å’Œè¾“å‡ºæ ¼å¼
- **prompt** ä¸­åŒ…å«è¯¦ç»†çš„è¦æ±‚å’Œè¾“å…¥æ•°æ®
- è¿™ç§åˆ†ç¦»è®©ä»£ç æ›´æ¸…æ™°ï¼šè§’è‰²å®šä¹‰å’Œä»»åŠ¡æè¿°åˆ†å¼€

**ä¸ºä»€ä¹ˆç”¨ Markdown è¡¨æ ¼**ï¼Ÿ
1. æµ‹è¯•ç”¨ä¾‹éœ€è¦åŒ…å«å¤šä¸ªå­—æ®µï¼ˆIDã€æ ‡é¢˜ã€æ­¥éª¤ã€é¢„æœŸç»“æœç­‰ï¼‰ï¼Œè¡¨æ ¼æœ€é€‚åˆ
2. Markdown æ ¼å¼å¯è¯»æ€§å¥½ï¼Œå‰ç«¯å¯ä»¥ç›´æ¥æ¸²æŸ“
3. ä¾¿äºäººå·¥reviewå’Œä¿®æ”¹

##### è´¨é‡è¯„å®¡ä¸“å®¶

ä» `backend/app/llm/autogen_runner.py` çš„ `run_quality_review` å‡½æ•°ï¼š

```python
system_message = (
    "ä½ æ˜¯è´¨é‡è¯„å®¡ä¸“å®¶ã€‚ä»”ç»†è¯„å®¡æµ‹è¯•ç”¨ä¾‹çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ï¼Œ"
    "ä»¥Markdownæ ¼å¼è¾“å‡ºè¯„å®¡æŠ¥å‘Šã€‚"
)
```

**å¯¹åº”çš„ prompt**ï¼š

```python
review_prompt = (
    "è¯·è¯„å®¡ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥Markdownæ ¼å¼è¾“å‡ºè¯„å®¡æŠ¥å‘Šã€‚è¦æ±‚:\n"
    "1. ä½¿ç”¨ ## è¯„å®¡æ‘˜è¦ ç« èŠ‚ï¼Œè¯´æ˜è¦†ç›–ç‡è¯„ä¼°å’Œæ•´ä½“è¯„ä»·\n"
    "2. ä½¿ç”¨ ## å‘ç°çš„ç¼ºé™· ç« èŠ‚ï¼Œåˆ—å‡ºå…·ä½“ç¼ºé™·å’Œé—æ¼çš„åŠŸèƒ½ç‚¹\n"
    "3. ä½¿ç”¨ ## æ”¹è¿›å»ºè®® ç« èŠ‚ï¼Œæä¾›é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®\n"
    "4. é‡ç‚¹å…³æ³¨åŠŸèƒ½è¡Œä¸ºçš„å®Œæ•´æ€§ï¼ˆä¸»æµç¨‹ã€å¼‚å¸¸æµç¨‹ã€è¾¹ç•Œæ¡ä»¶ç­‰ï¼‰\n\n"
    f"æµ‹è¯•ç”¨ä¾‹:\n{test_content}"
)
```

**è®¾è®¡æ€è·¯**ï¼š
- è¯„å®¡ä¸“å®¶çš„èŒè´£æ˜¯"æ‰¾é—®é¢˜"ï¼Œæ‰€ä»¥ prompt ä¸­å¼ºè°ƒ"ç¼ºé™·"ã€"é—æ¼"ã€"æ”¹è¿›"
- è¾“å‡ºåˆ†ä¸‰ä¸ªç« èŠ‚ï¼Œç»“æ„æ¸…æ™°
- "é‡ç‚¹å…³æ³¨åŠŸèƒ½è¡Œä¸ºçš„å®Œæ•´æ€§" â†’ å¼•å¯¼è¯„å®¡æ–¹å‘

##### æµ‹è¯•è¡¥å…¨å·¥ç¨‹å¸ˆ

ä» `backend/app/llm/autogen_runner.py` çš„ `run_test_completion` å‡½æ•°ï¼š

```python
system_message = (
    "ä½ æ˜¯ä¸€ä½æµ‹è¯•è¡¥å…¨å·¥ç¨‹å¸ˆã€‚æ ¹æ®è´¨é‡è¯„å®¡å‘ç°çš„ç¼ºå£ä¸å»ºè®®ï¼Œ"
    "ä»¥Markdownæ ¼å¼è¡¥å……ç¼ºå¤±çš„æµ‹è¯•ç”¨ä¾‹ã€‚"
)
```

**å¯¹åº”çš„ prompt**ï¼š

```python
completion_prompt = (
    "è¯·æ ¹æ®è´¨é‡è¯„å®¡çš„ç¼ºé™·å’Œå»ºè®®ï¼Œä»¥Markdownæ ¼å¼è¡¥å……æµ‹è¯•ç”¨ä¾‹ã€‚è¦æ±‚:\n"
    "1. ä½¿ç”¨ä¸åŸæµ‹è¯•ç”¨ä¾‹ç›¸åŒçš„Markdownè¡¨æ ¼æ ¼å¼\n"
    "2. åªè¡¥å……ç¼ºå¤±çš„ç”¨ä¾‹ï¼Œä¸é‡å¤å·²æœ‰å†…å®¹\n"
    "3. æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨ ## æ ‡é¢˜\n"
    "4. æ¯æ¡æµ‹è¯•ç”¨ä¾‹åŒ…å«æ˜ç¡®çš„æ­¥éª¤å’Œå¯éªŒè¯çš„é¢„æœŸç»“æœ\n\n"
    f"åŸå§‹æµ‹è¯•ç”¨ä¾‹:\n{test_content}\n\n"
    f"è´¨é‡è¯„å®¡æŠ¥å‘Š:\n{review_content}"
)
```

**è®¾è®¡æ€è·¯**ï¼š
- è¡¥å…¨å·¥ç¨‹å¸ˆéœ€è¦åŒæ—¶çœ‹åˆ°"åŸå§‹ç”¨ä¾‹"å’Œ"è¯„å®¡æŠ¥å‘Š"
- "åªè¡¥å……ç¼ºå¤±çš„ç”¨ä¾‹ï¼Œä¸é‡å¤å·²æœ‰å†…å®¹" â†’ é¿å…å†—ä½™
- "ä½¿ç”¨ç›¸åŒçš„è¡¨æ ¼æ ¼å¼" â†’ ä¿æŒä¸€è‡´æ€§ï¼Œä¾¿äºåç»­åˆå¹¶

#### system_message ç¼–å†™æ£€æŸ¥æ¸…å•

åœ¨ç¼–å†™ system_message æ—¶ï¼Œé—®è‡ªå·±è¿™äº›é—®é¢˜ï¼š

- [ ] æ˜¯å¦æ˜ç¡®å®šä¹‰äº†æ™ºèƒ½ä½“çš„è§’è‰²ï¼Ÿ
- [ ] æ˜¯å¦æ¸…æ¥šè¯´æ˜äº†è¦åšä»€ä¹ˆï¼Ÿ
- [ ] æ˜¯å¦æŒ‡å®šäº†è¾“å‡ºæ ¼å¼ï¼Ÿ
- [ ] æ˜¯å¦æ·»åŠ äº†å¿…è¦çš„çº¦æŸæ¡ä»¶ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†æ¨¡ç³Šæˆ–äºŒä¹‰æ€§çš„æè¿°ï¼Ÿ
- [ ] æ˜¯å¦è¶³å¤Ÿå…·ä½“ï¼Œè®©æ™ºèƒ½ä½“ç†è§£ä»»åŠ¡ç»†èŠ‚ï¼Ÿ

### 3. llm_configï¼ˆæ¨¡å‹é…ç½®ï¼‰

#### llm_config çš„ç»“æ„

```python
llm_config = {
    "config_list": [  # æ¨¡å‹é…ç½®åˆ—è¡¨ï¼ˆæ”¯æŒå¤šä¸ªå¤‡é€‰ï¼‰
        {
            "model": "qwen-plus",          # æ¨¡å‹åç§°
            "api_key": "sk-xxx",           # API å¯†é’¥
            "base_url": "https://...",     # API åœ°å€
            "api_type": "openai",          # å¯é€‰ï¼šAPI ç±»å‹
            "api_version": "2024-02-01",   # å¯é€‰ï¼šAPI ç‰ˆæœ¬ï¼ˆAzure éœ€è¦ï¼‰
        }
    ],
    "timeout": 120,            # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    "temperature": 0.7,        # å¯é€‰ï¼šåˆ›é€ æ€§ç¨‹åº¦ï¼ˆ0-2ï¼‰
    "max_tokens": 4096,        # å¯é€‰ï¼šæœ€å¤§è¾“å‡º token æ•°
    "top_p": 0.9,              # å¯é€‰ï¼šé‡‡æ ·å‚æ•°
}
```

#### config_list è¯¦è§£

`config_list` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å‹é…ç½®ã€‚AutoGen ä¼šæŒ‰é¡ºåºå°è¯•ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå¤±è´¥åˆ™ä½¿ç”¨ç¬¬äºŒä¸ªï¼ˆfailover æœºåˆ¶ï¼‰ã€‚

##### å•æ¨¡å‹é…ç½®ï¼ˆæœ€å¸¸è§ï¼‰

```python
"config_list": [{
    "model": "qwen-plus",
    "api_key": "sk-your-api-key",
    "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1"
}]
```

##### å¤šæ¨¡å‹å¤‡é€‰é…ç½®ï¼ˆé«˜å¯ç”¨ï¼‰

```python
"config_list": [
    {
        "model": "qwen3-next-80b",  # ä¸»æ¨¡å‹ï¼šæ€§èƒ½å¼ºï¼Œä½†å¯èƒ½é™æµ
        "api_key": "sk-xxx",
    },
    {
        "model": "qwen-plus",  # å¤‡é€‰æ¨¡å‹ï¼šæ€§èƒ½ç¨å¼±ï¼Œä½†ç¨³å®š
        "api_key": "sk-xxx",
    }
]
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- ä¸»æ¨¡å‹é‡åˆ°é™æµæˆ–æ•…éšœæ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡é€‰æ¨¡å‹
- é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§

##### è·¨æä¾›å•†é…ç½®ï¼ˆæè‡´é«˜å¯ç”¨ï¼‰

```python
"config_list": [
    {
        "model": "qwen-plus",
        "api_key": "sk-qwen-xxx",
        "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1"
    },
    {
        "model": "gpt-4",
        "api_key": "sk-openai-xxx",
        "base_url": "https://api.openai.com/v1"
    }
]
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦æé«˜å¯ç”¨æ€§çš„å…³é”®ä¸šåŠ¡
- ä¸€ä¸ªæä¾›å•†å®Œå…¨ä¸å¯ç”¨æ—¶ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ª

#### timeoutï¼ˆè¶…æ—¶æ—¶é—´ï¼‰

`timeout` æŒ‡å®šå•æ¬¡ API è°ƒç”¨çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ã€‚è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼ŒAutoGen ä¼šæŠ›å‡º TimeoutErrorã€‚

##### å¦‚ä½•é€‰æ‹©åˆé€‚çš„ timeoutï¼Ÿ

```python
# ç®€å•ä»»åŠ¡ï¼ˆæ–‡æœ¬åˆ†ç±»ã€å®ä½“æå–ï¼‰
"timeout": 30  # 30 ç§’è¶³å¤Ÿ

# ä¸­ç­‰ä»»åŠ¡ï¼ˆéœ€æ±‚åˆ†æã€æ‘˜è¦ç”Ÿæˆï¼‰
"timeout": 120  # 2 åˆ†é’Ÿï¼ˆé¡¹ç›®é»˜è®¤å€¼ï¼‰

# å¤æ‚ä»»åŠ¡ï¼ˆä»£ç ç”Ÿæˆã€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼‰
"timeout": 300  # 5 åˆ†é’Ÿ

# è¶…å¤æ‚ä»»åŠ¡ï¼ˆå¤§è§„æ¨¡æ¨ç†ã€é•¿æ–‡æœ¬ç”Ÿæˆï¼‰
"timeout": 600  # 10 åˆ†é’Ÿ
```

**æœ€ä½³å®è·µ**ï¼š
- æ ¹æ®ä»»åŠ¡å¤æ‚åº¦åŠ¨æ€è°ƒæ•´ï¼Œä¸è¦ä¸€åˆ€åˆ‡
- å¤ªçŸ­ï¼šå®¹æ˜“è¶…æ—¶ï¼Œç”¨æˆ·ä½“éªŒå·®
- å¤ªé•¿ï¼šæŒ‚èµ·æ—¶é—´å¤ªä¹…ï¼Œèµ„æºæµªè´¹

##### é¡¹ç›®å®æˆ˜ï¼šä¸åŒæ™ºèƒ½ä½“çš„ timeout è®¾ç½®

ä» `backend/app/llm/autogen_runner.py`ï¼š

```python
def _agent(system_message: str, agent_type: str = "default") -> AssistantAgent:
    return AssistantAgent(
        # ...
        llm_config={
            "config_list": [config],
            "timeout": settings.llm_timeout,  # é»˜è®¤ 120 ç§’
        },
    )
```

é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„ 120 ç§’è¶…æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¹³è¡¡çš„é€‰æ‹©ï¼š
- éœ€æ±‚åˆ†æï¼šå¤„ç†å›¾ç‰‡æ–‡æ¡£å¯èƒ½è¾ƒæ…¢ï¼Œ120 ç§’é€šå¸¸å¤Ÿç”¨
- æµ‹è¯•ç”Ÿæˆï¼šç”Ÿæˆå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ120 ç§’å¯èƒ½æœ‰ç‚¹ç´§å¼ ï¼Œä½†å¯æ¥å—
- è´¨é‡è¯„å®¡å’Œè¡¥å…¨ï¼šç›¸å¯¹ç®€å•ï¼Œ120 ç§’ç»°ç»°æœ‰ä½™

**æ”¹è¿›å»ºè®®**ï¼šå¯ä»¥ä¸ºä¸åŒæ™ºèƒ½ä½“è®¾ç½®ä¸åŒçš„ timeoutï¼š

```python
TIMEOUT_CONFIG = {
    "analysis": 180,     # éœ€æ±‚åˆ†æï¼š3 åˆ†é’Ÿï¼ˆå¤„ç†å›¾ç‰‡ï¼‰
    "test": 240,         # æµ‹è¯•ç”Ÿæˆï¼š4 åˆ†é’Ÿï¼ˆç”Ÿæˆå¤§é‡ç”¨ä¾‹ï¼‰
    "review": 120,       # è´¨é‡è¯„å®¡ï¼š2 åˆ†é’Ÿ
    "completion": 180,   # ç”¨ä¾‹è¡¥å…¨ï¼š3 åˆ†é’Ÿ
}

def _agent(system_message: str, agent_type: str = "default") -> AssistantAgent:
    timeout = TIMEOUT_CONFIG.get(agent_type, 120)
    return AssistantAgent(
        llm_config={"timeout": timeout, ...},
    )
```

#### temperatureï¼ˆåˆ›é€ æ€§ç¨‹åº¦ï¼‰

`temperature` æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§å’Œåˆ›é€ æ€§ï¼ŒèŒƒå›´é€šå¸¸æ˜¯ 0-2ï¼š
- **0**ï¼šå®Œå…¨ç¡®å®šæ€§ï¼Œæ¯æ¬¡è¾“å‡ºå‡ ä¹ç›¸åŒ
- **0.1-0.3**ï¼šä½éšæœºæ€§ï¼Œé€‚åˆç²¾ç¡®ä»»åŠ¡
- **0.7-1.0**ï¼šä¸­ç­‰éšæœºæ€§ï¼Œå¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§
- **1.5-2.0**ï¼šé«˜éšæœºæ€§ï¼Œé€‚åˆåˆ›æ„ä»»åŠ¡

##### å¦‚ä½•é€‰æ‹© temperatureï¼Ÿ

```python
# ç²¾ç¡®ä»»åŠ¡ï¼ˆæ•°æ®æå–ã€åˆ†ç±»ã€æ ¼å¼è½¬æ¢ï¼‰
"temperature": 0.1

# åˆ†æä»»åŠ¡ï¼ˆéœ€æ±‚åˆ†æã€ä»£ç å®¡æŸ¥ï¼‰
"temperature": 0.5

# å¹³è¡¡ä»»åŠ¡ï¼ˆå¤§å¤šæ•°åœºæ™¯ï¼‰
"temperature": 0.7  # æ¨èé»˜è®¤å€¼

# ç”Ÿæˆä»»åŠ¡ï¼ˆæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€æ–‡æ¡ˆæ’°å†™ï¼‰
"temperature": 0.9

# åˆ›æ„ä»»åŠ¡ï¼ˆå¤´è„‘é£æš´ã€æ•…äº‹åˆ›ä½œï¼‰
"temperature": 1.2
```

**é¡¹ç›®ä¸­çš„é€‰æ‹©**ï¼š

é¡¹ç›®ä»£ç ä¸­æ²¡æœ‰æ˜¾å¼è®¾ç½® temperatureï¼Œæ„å‘³ç€ä½¿ç”¨æ¨¡å‹é»˜è®¤å€¼ï¼ˆé€šå¸¸æ˜¯ 1.0ï¼‰ã€‚

**æ”¹è¿›å»ºè®®**ï¼š

```python
TEMPERATURE_CONFIG = {
    "analysis": 0.3,    # éœ€æ±‚åˆ†æï¼šéœ€è¦å‡†ç¡®æå–ï¼Œä¸è¦å‘æŒ¥
    "test": 0.8,        # æµ‹è¯•ç”Ÿæˆï¼šéœ€è¦åˆ›é€ æ€§ï¼Œè¦†ç›–å¤šç§åœºæ™¯
    "review": 0.5,      # è´¨é‡è¯„å®¡ï¼šéœ€è¦ä¸¥è°¨ï¼Œä½†ä¸èƒ½å¤ªæ­»æ¿
    "completion": 0.8,  # ç”¨ä¾‹è¡¥å…¨ï¼šéœ€è¦åˆ›é€ æ€§ï¼Œè¡¥å……æ–°åœºæ™¯
}
```

#### max_tokensï¼ˆæœ€å¤§è¾“å‡ºé•¿åº¦ï¼‰

`max_tokens` é™åˆ¶æ¨¡å‹å•æ¬¡è¾“å‡ºçš„æœ€å¤§ token æ•°ã€‚1 token â‰ˆ 0.75 ä¸ªè‹±æ–‡å•è¯ï¼Œâ‰ˆ 0.5 ä¸ªä¸­æ–‡å­—ã€‚

##### å¦‚ä½•ä¼°ç®— max_tokensï¼Ÿ

```python
# ç®€çŸ­å›ç­”ï¼ˆ100-200 å­—ï¼‰
"max_tokens": 300

# ä¸­ç­‰å›ç­”ï¼ˆ500-1000 å­—ï¼‰
"max_tokens": 1500

# é•¿å›ç­”ï¼ˆ2000-3000 å­—ï¼‰
"max_tokens": 4096  # é€šå¸¸æ˜¯ä¸Šé™

# è¶…é•¿å›ç­”ï¼ˆ5000+ å­—ï¼‰
"max_tokens": 8192  # éƒ¨åˆ†æ¨¡å‹æ”¯æŒ
```

**é¡¹ç›®ä¸­çš„é€‰æ‹©**ï¼š

é¡¹ç›®æ²¡æœ‰æ˜¾å¼è®¾ç½® max_tokensï¼Œæ„å‘³ç€ä½¿ç”¨æ¨¡å‹é»˜è®¤å€¼ï¼ˆqwen-plus æ˜¯ 2048ï¼‰ã€‚

**æ½œåœ¨é—®é¢˜**ï¼š
- æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå¯èƒ½éœ€è¦å¾ˆé•¿çš„è¾“å‡ºï¼ˆå¤šä¸ªæ¨¡å—ã€æ¯ä¸ªæ¨¡å—å¤šä¸ªç”¨ä¾‹ï¼‰
- å¦‚æœè¶…è¿‡ 2048 tokensï¼Œè¾“å‡ºä¼šè¢«æˆªæ–­

**æ”¹è¿›å»ºè®®**ï¼š

```python
MAX_TOKENS_CONFIG = {
    "analysis": 2048,     # éœ€æ±‚åˆ†æï¼šJSON è¾“å‡ºï¼Œé€šå¸¸ä¸ä¼šå¤ªé•¿
    "test": 8192,         # æµ‹è¯•ç”Ÿæˆï¼šMarkdown è¡¨æ ¼ï¼Œå¯èƒ½å¾ˆé•¿
    "review": 2048,       # è´¨é‡è¯„å®¡ï¼šæŠ¥å‘Šé€šå¸¸ä¸­ç­‰é•¿åº¦
    "completion": 4096,   # ç”¨ä¾‹è¡¥å…¨ï¼šè¡¥å……ç”¨ä¾‹ï¼Œå¯èƒ½è¾ƒé•¿
}
```

### 4. human_input_modeï¼ˆäººå·¥ä»‹å…¥æ¨¡å¼ï¼‰

#### ä¸‰ç§æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `NEVER` | å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œä¸éœ€è¦äººå·¥è¾“å…¥ | åå°æ‰¹å¤„ç†ã€è‡ªåŠ¨åŒ–ä»»åŠ¡ |
| `TERMINATE` | å¯¹è¯ç»“æŸæ—¶è¯·æ±‚ç¡®è®¤ | éœ€è¦æœ€ç»ˆå®¡æ ¸çš„ä»»åŠ¡ |
| `ALWAYS` | æ¯æ¬¡å›å¤å‰éƒ½è¯¢é—®äººå·¥ | äº¤äº’å¼åŠ©æ‰‹ã€é«˜é£é™©æ“ä½œ |

#### é¡¹ç›®ä¸­çš„é€‰æ‹©

é¡¹ç›®ä½¿ç”¨ `NEVER`ï¼š

```python
AssistantAgent(
    # ...
    human_input_mode="NEVER",  # ä¸åœ¨æ™ºèƒ½ä½“å±‚é¢ç­‰å¾…äººå·¥è¾“å…¥
)
```

**ä¸ºä»€ä¹ˆé€‰æ‹© NEVER**ï¼Ÿ

å› ä¸ºé¡¹ç›®åœ¨**å·¥ä½œæµå±‚é¢**å®ç°äº†è‡ªå®šä¹‰çš„äººå·¥ç¡®è®¤æœºåˆ¶ï¼ˆè§ `backend/app/orchestrator/workflow.py` çš„ `_wait_for_confirmation` å‡½æ•°ï¼‰ï¼š

```python
async def _wait_for_confirmation(self, stage: AgentStage, timeout: int = 300) -> bool:
    """ç­‰å¾…ç”¨æˆ·ç¡®è®¤å½“å‰é˜¶æ®µçš„ç»“æœ."""
    # è½®è¯¢ç­‰å¾…ç”¨æˆ·ç¡®è®¤...
    for _ in range(timeout):
        await asyncio.sleep(1)
        confirmation = await session_events.get_confirmation(self.session_id)
        if confirmation and confirmation.get("confirmed"):
            return True
        elif confirmation and confirmation.get("rejected"):
            return False
    return False  # è¶…æ—¶
```

è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š
- **æ›´çµæ´»**ï¼šå¯ä»¥åœ¨ä»»æ„æ­¥éª¤ä¹‹é—´æ’å…¥ç¡®è®¤ç‚¹
- **æ›´å¯æ§**ï¼šå¯ä»¥è‡ªå®šä¹‰ç¡®è®¤é€»è¾‘ï¼ˆè¶…æ—¶ã€æ‹’ç»å¤„ç†ç­‰ï¼‰
- **æ›´å‹å¥½**ï¼šé€šè¿‡ WebSocket å®æ—¶æ¨é€ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½

#### ä½•æ—¶ä½¿ç”¨ TERMINATE æˆ– ALWAYSï¼Ÿ

```python
# ä½¿ç”¨ TERMINATEï¼šéœ€è¦æœ€ç»ˆå®¡æ ¸
chatbot = AssistantAgent(
    name="chatbot",
    system_message="ä½ æ˜¯ä¸€ä½å®¢æœåŠ©æ‰‹",
    human_input_mode="TERMINATE",  # å›ç­”å®Œæˆåï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤æ˜¯å¦æ»¡æ„
)

# ä½¿ç”¨ ALWAYSï¼šé«˜é£é™©æ“ä½œ
database_admin = AssistantAgent(
    name="database_admin",
    system_message="ä½ æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ï¼Œå¯ä»¥æ‰§è¡ŒSQLè¯­å¥",
    human_input_mode="ALWAYS",  # æ¯æ¬¡æ‰§è¡ŒSQLå‰éƒ½è¦äººå·¥ç¡®è®¤
    code_execution_config={"work_dir": "./db_workspace"},
)
```

### 5. max_consecutive_auto_replyï¼ˆæœ€å¤§è‡ªåŠ¨å›å¤æ¬¡æ•°ï¼‰

#### ä½œç”¨

é™åˆ¶æ™ºèƒ½ä½“è¿ç»­è‡ªåŠ¨å›å¤çš„æ¬¡æ•°ï¼Œé˜²æ­¢æ— é™å¾ªç¯ã€‚

#### é¡¹ç›®ä¸­çš„é€‰æ‹©

```python
AssistantAgent(
    # ...
    max_consecutive_auto_reply=1,  # åªè‡ªåŠ¨å›å¤ä¸€æ¬¡
)
```

**ä¸ºä»€ä¹ˆè®¾ç½®ä¸º 1**ï¼Ÿ

å› ä¸ºé¡¹ç›®çš„å·¥ä½œæµæ˜¯**çº¿æ€§çš„ã€å•å‘çš„**ï¼š

```
éœ€æ±‚åˆ†æå¸ˆ â†’ æµ‹è¯•å·¥ç¨‹å¸ˆ â†’ è´¨é‡è¯„å®¡ä¸“å®¶ â†’ æµ‹è¯•è¡¥å…¨å·¥ç¨‹å¸ˆ
```

æ¯ä¸ªæ™ºèƒ½ä½“åªéœ€è¦å›å¤ä¸€æ¬¡ï¼Œä¸éœ€è¦å¤šè½®å¯¹è¯ã€‚

#### ä½•æ—¶éœ€è¦æ›´å¤§çš„å€¼ï¼Ÿ

```python
# ç®€å•å¤šè½®å¯¹è¯
chatbot = AssistantAgent(
    name="chatbot",
    max_consecutive_auto_reply=3,  # æœ€å¤šè‡ªåŠ¨å›å¤ 3 æ¬¡
)

# å¤æ‚åä½œä»»åŠ¡ï¼ˆä¸¤ä¸ªæ™ºèƒ½ä½“äº’ç›¸è®¨è®ºï¼‰
analyst = AssistantAgent(
    name="analyst",
    max_consecutive_auto_reply=5,  # ä¸å¼€å‘è®¨è®ºéœ€æ±‚ï¼Œæœ€å¤š 5 è½®
)

developer = AssistantAgent(
    name="developer",
    max_consecutive_auto_reply=5,
)
```

### 6. code_execution_configï¼ˆä»£ç æ‰§è¡Œé…ç½®ï¼‰

#### ä½œç”¨

æ§åˆ¶æ™ºèƒ½ä½“æ˜¯å¦å¯ä»¥æ‰§è¡Œä»£ç ï¼ˆPythonã€Shell ç­‰ï¼‰ã€‚

#### é¡¹ç›®ä¸­çš„é€‰æ‹©

```python
AssistantAgent(
    # ...
    code_execution_config=False,  # ç¦ç”¨ä»£ç æ‰§è¡Œ
)
```

**ä¸ºä»€ä¹ˆç¦ç”¨**ï¼Ÿ

å› ä¸ºé¡¹ç›®çš„æ™ºèƒ½ä½“åªéœ€è¦è¿›è¡Œ**æ–‡æœ¬åˆ†æå’Œç”Ÿæˆ**ï¼Œä¸éœ€è¦æ‰§è¡Œä»£ç ã€‚ç¦ç”¨ä»£ç æ‰§è¡Œæœ‰ä¸¤ä¸ªå¥½å¤„ï¼š
1. **å®‰å…¨æ€§**ï¼šé¿å…æ¶æ„ä»£ç æ³¨å…¥é£é™©
2. **æ€§èƒ½**ï¼šä¸éœ€è¦å¯åŠ¨ä»£ç æ‰§è¡Œç¯å¢ƒ

#### ä½•æ—¶å¯ç”¨ä»£ç æ‰§è¡Œï¼Ÿ

```python
# æ•°æ®åˆ†æåŠ©æ‰‹
data_analyst = AssistantAgent(
    name="data_analyst",
    system_message="ä½ æ˜¯æ•°æ®åˆ†æå¸ˆï¼Œå¯ä»¥ç¼–å†™ Python ä»£ç åˆ†ææ•°æ®",
    code_execution_config={
        "work_dir": "./workspace",  # ä»£ç æ‰§è¡Œç›®å½•
        "use_docker": True,          # ä½¿ç”¨ Docker éš”ç¦»ï¼ˆæ¨èï¼‰
        "timeout": 60,               # ä»£ç æ‰§è¡Œè¶…æ—¶æ—¶é—´
    },
)
```

**å®‰å…¨æç¤º**ï¼šå¦‚æœå¯ç”¨ä»£ç æ‰§è¡Œï¼Œå¼ºçƒˆå»ºè®®ï¼š
1. ä½¿ç”¨ Docker éš”ç¦»ï¼ˆ`use_docker=True`ï¼‰
2. é™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®
3. è®¾ç½®èµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ï¼‰
4. å¯ç”¨äººå·¥å®¡æ ¸ï¼ˆ`human_input_mode="ALWAYS"`ï¼‰

## å®Œæ•´é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šéœ€æ±‚åˆ†æå¸ˆï¼ˆé¡¹ç›®çœŸå®é…ç½®ï¼‰

```python
from autogen import AssistantAgent
from app.config import settings

requirement_analyst = AssistantAgent(
    name="requirement_analyst",
    system_message=(
        "ä½ æ˜¯ä¸€ä½èµ„æ·±éœ€æ±‚åˆ†æå¸ˆã€‚è¯·ä»”ç»†é˜…è¯»éœ€æ±‚æ–‡æ¡£ï¼Œ"
        "è¯†åˆ«å¹¶æå–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…·ä½“åŠŸèƒ½æ¨¡å—ã€ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡è§„åˆ™ã€‚"
        "å¿…é¡»åŸºäºæ–‡æ¡£çš„å®é™…å†…å®¹è¿›è¡Œåˆ†æï¼Œä¸è¦ä½¿ç”¨æ³›åŒ–çš„å ä½ç¬¦ã€‚"
        "è¾“å‡ºJSONæ ¼å¼ï¼ŒåŒ…å«: modules (nameä¸ºå®é™…æ¨¡å—å, scenariosä¸ºå…·ä½“åœºæ™¯æè¿°[], "
        "rulesä¸ºå…·ä½“è§„åˆ™æè¿°[]), risks[]ã€‚"
    ),
    llm_config={
        "config_list": [{
            "model": "qwen3-vl-flash",  # å¤šæ¨¡æ€è§†è§‰æ¨¡å‹ï¼Œæ”¯æŒå›¾ç‰‡
            "api_key": settings.qwen_api_key,
            "base_url": settings.qwen_base_url,
        }],
        "timeout": 180,  # 3 åˆ†é’Ÿï¼ˆå¤„ç†å›¾ç‰‡éœ€è¦æ›´å¤šæ—¶é—´ï¼‰
        "temperature": 0.3,  # ä½éšæœºæ€§ï¼Œç¡®ä¿æå–å‡†ç¡®
        "max_tokens": 2048,
    },
    human_input_mode="NEVER",
    max_consecutive_auto_reply=1,
    code_execution_config=False,
)
```

### ç¤ºä¾‹ 2ï¼šæµ‹è¯•å·¥ç¨‹å¸ˆï¼ˆæ”¹è¿›ç‰ˆï¼‰

```python
test_engineer = AssistantAgent(
    name="test_engineer",
    system_message=(
        "ä½ æ˜¯ä¸€ä½èµ„æ·±æµ‹è¯•å·¥ç¨‹å¸ˆã€‚æ ¹æ®éœ€æ±‚åˆ†æç»“æœï¼Œ"
        "ä¸ºæ¯ä¸ªå…·ä½“åŠŸèƒ½æ¨¡å—ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹ã€‚"
        "è¯·ä»¥Markdownæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«æ¸…æ™°çš„ç« èŠ‚ç»“æ„å’Œè¡¨æ ¼ã€‚"
    ),
    llm_config={
        "config_list": [{
            "model": "qwen3-next-80b-a3b-instruct",  # å¼ºæ¨ç†æ¨¡å‹
            "api_key": settings.qwen_api_key,
            "base_url": settings.qwen_base_url,
        }],
        "timeout": 240,  # 4 åˆ†é’Ÿï¼ˆç”Ÿæˆå¤§é‡ç”¨ä¾‹ï¼‰
        "temperature": 0.8,  # ä¸­é«˜éšæœºæ€§ï¼Œé¼“åŠ±åˆ›é€ æ€§
        "max_tokens": 8192,  # å¤§è¾“å‡ºç©ºé—´ï¼Œæ”¯æŒé•¿è¡¨æ ¼
    },
    human_input_mode="NEVER",
    max_consecutive_auto_reply=1,
    code_execution_config=False,
)
```

## é…ç½®æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå˜é‡ç®¡ç†

âŒ **ä¸è¦ç¡¬ç¼–ç  API å¯†é’¥**ï¼š

```python
llm_config = {
    "config_list": [{
        "api_key": "sk-123456789",  # å±é™©ï¼å¯èƒ½æ³„éœ²åˆ°ä»£ç ä»“åº“
    }]
}
```

âœ… **ä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼š

```python
from app.config import settings

llm_config = {
    "config_list": [{
        "api_key": settings.qwen_api_key,  # ä»ç¯å¢ƒå˜é‡è¯»å–
        "base_url": settings.qwen_base_url,
    }]
}
```

### 2. æ ¹æ®ä»»åŠ¡è°ƒæ•´å‚æ•°

```python
# ç²¾ç¡®ä»»åŠ¡ï¼ˆæ•°æ®æå–ï¼‰
precise_config = {
    "timeout": 60,
    "temperature": 0.1,
    "max_tokens": 1024,
}

# åˆ›é€ ä»»åŠ¡ï¼ˆæµ‹è¯•ç”Ÿæˆï¼‰
creative_config = {
    "timeout": 240,
    "temperature": 0.9,
    "max_tokens": 8192,
}
```

### 3. ä½¿ç”¨é…ç½®å·¥å‚å‡½æ•°

```python
def create_llm_config(
    model: str,
    timeout: int = 120,
    temperature: float = 0.7,
    max_tokens: int = 2048,
) -> dict:
    return {
        "config_list": [{
            "model": model,
            "api_key": settings.qwen_api_key,
            "base_url": settings.qwen_base_url,
        }],
        "timeout": timeout,
        "temperature": temperature,
        "max_tokens": max_tokens,
    }

# ä½¿ç”¨
analyst_config = create_llm_config(
    model="qwen3-vl-flash",
    timeout=180,
    temperature=0.3,
)
```

### 4. è®°å½•å’Œç›‘æ§

```python
import logging

logger = logging.getLogger(__name__)

def create_agent(name, system_message, llm_config):
    logger.info(f"åˆ›å»ºæ™ºèƒ½ä½“: {name}")
    logger.info(f"æ¨¡å‹: {llm_config['config_list'][0]['model']}")
    logger.info(f"è¶…æ—¶: {llm_config['timeout']}s")
    
    return AssistantAgent(
        name=name,
        system_message=system_message,
        llm_config=llm_config,
    )
```

## è°ƒè¯•æŠ€å·§

### 1. æ‰“å°å®Œæ•´é…ç½®

```python
import json

agent = create_agent(...)
print("æ™ºèƒ½ä½“é…ç½®:")
print(json.dumps({
    "name": agent.name,
    "system_message": agent.system_message,
    "llm_config": agent.llm_config,
}, indent=2, ensure_ascii=False))
```

### 2. å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

### 3. æµ‹è¯•ä¸åŒé…ç½®çš„æ•ˆæœ

```python
test_configs = [
    {"temperature": 0.1, "label": "ä½éšæœºæ€§"},
    {"temperature": 0.7, "label": "ä¸­ç­‰éšæœºæ€§"},
    {"temperature": 1.2, "label": "é«˜éšæœºæ€§"},
]

for config in test_configs:
    agent = AssistantAgent(
        name="test",
        system_message="ä½ æ˜¯æµ‹è¯•å·¥ç¨‹å¸ˆ",
        llm_config={
            "config_list": [{"model": "qwen-plus"}],
            "temperature": config["temperature"],
        },
    )
    
    reply = agent.generate_reply(
        messages=[{"role": "user", "content": "ç”Ÿæˆç™»å½•åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹"}]
    )
    
    print(f"\n{config['label']} (temperature={config['temperature']}):")
    print(reply[:300], "...")
```

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ‡æ¢åˆ° Azure OpenAIï¼Ÿ

```python
llm_config = {
    "config_list": [{
        "model": "gpt-4",
        "api_type": "azure",
        "api_key": "your-azure-key",
        "base_url": "https://your-resource.openai.azure.com/",
        "api_version": "2024-02-01",
    }],
}
```

### Q2: å¦‚ä½•é…ç½®å¤šä¸ªå¤‡é€‰æ¨¡å‹ï¼Ÿ

```python
llm_config = {
    "config_list": [
        {"model": "qwen3-next-80b", "api_key": "sk-xxx"},  # ä¸»æ¨¡å‹
        {"model": "qwen-plus", "api_key": "sk-xxx"},        # å¤‡é€‰
    ],
}
# AutoGen ä¼šæŒ‰é¡ºåºå°è¯•
```

### Q3: å¦‚ä½•é™åˆ¶æˆæœ¬ï¼Ÿ

```python
# 1. ä½¿ç”¨è¾ƒå°çš„æ¨¡å‹
"model": "qwen-plus"  # è€Œä¸æ˜¯ qwen3-next-80b

# 2. é™åˆ¶è¾“å‡ºé•¿åº¦
"max_tokens": 1024  # è€Œä¸æ˜¯ 8192

# 3. ç¼©çŸ­è¶…æ—¶æ—¶é—´
"timeout": 60  # è€Œä¸æ˜¯ 300

# 4. é™ä½ temperatureï¼ˆå‡å°‘é‡è¯•æ¬¡æ•°ï¼‰
"temperature": 0.1
```

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº†æ™ºèƒ½ä½“é…ç½®çš„æ‰€æœ‰ç»†èŠ‚ï¼Œæ¥ä¸‹æ¥å­¦ä¹ ï¼š

ğŸ“— [å¤šæ™ºèƒ½ä½“åä½œå®æˆ˜](./03-multi-agent-workflow.md) - è®©å¤šä¸ªæ™ºèƒ½ä½“ååŒå·¥ä½œ

---

**å‚è€ƒèµ„æº**ï¼š
- é¡¹ç›®æºç ï¼š`backend/app/llm/autogen_runner.py`
- é…ç½®æ–‡ä»¶ï¼š`backend/.env.example`
